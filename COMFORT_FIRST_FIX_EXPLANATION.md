# ุฑุงูโุญู ูุดฺฉู Comfort Loss ุจุงูุง ุฏุฑ PI-DRL Controller

## ูุดฺฉู ุงุตู
ุณุณุชู PI-DRL ุดูุง ุจุง ูุฌูุฏ ุชุบุฑ ูุฒูโูุงุ ููฺูุงู ุจู ุฌุง ุงูููุช ุฏุงุฏู ุจู ุขุณุงุด ุญุฑุงุฑุชุ ุฑู ุตุฑููโุฌู ุฏุฑ ูุฒูู ุชูุฑฺฉุฒ ุฏุงุดุช. ูุชุฌู:
- **Comfort loss ูุงุฌุนูโุจุงุฑ** (ููุงุฏุฑ ุจุณุงุฑ ุจุงูุง)
- ุณุณุชู ุชูุฑุจุงู ููุดู OFF ุจูุฏ
- ุชูุงู ูพฺฉ ุตูุฑ (ฺูู ุฏุฑ ุณุงุนุงุช ฺฏุฑุงู ุฎุงููุด ุจูุฏ)
- ุฏูุง ุฏุงุฎู ูุฏุชโูุง ุฎุงุฑุฌ ุงุฒ ุจุงุฒู ุขุณุงุด

## ุชุบุฑุงุช ฺฉูุฏ ุฏุฑ ูุงู ุฌุฏุฏ (`pi_drl_hvac_controller_fixed.py`)

### ฑ. ูุฒูโูุง Reward (ุฎุทูุท 91-101)

```python
# ูุจู (ุงุดุชุจุงู):
w_cost:   float = 0.08      # ุฎู ุฒุงุฏ
w_disc:   float = 15        # ุฎู ฺฉู
w_peak:   float = 0.15      # ุจุงุนุซ ูโุดุฏ ุฏุฑ peak hours ุฎุงููุด ุจูุงูุฏ

# ุจุนุฏ (ุฏุฑุณุช):
w_cost:   float = 0.0001    # ุชูุฑุจุงู ุตูุฑ - ูุฒูู ุงููุช ูุฏุงุฑุฏ
w_disc:   float = 200.0     # ุฎู ุฒุงุฏ - ุฑุงุญุช ุงูููุช ุงูู ุงุณุช
w_peak:   float = 0.0       # ุตูุฑ - ุจู peak pricing ฺฉุงุฑ ูุฏุงุฑู
w_switch: float = 0.2       # ฺฉุงูุด ุงูุช ุชุง ุจุฑุง ุฑุงุญุช ุจุดุชุฑ ุณูุฆฺ ฺฉูุฏ
```

### ฒ. Normalization Scales (ุฎุทูุท 103-106)

```python
# ูุจู:
cost_scale:   float = 0.01   # ฺฉูฺฺฉ โ penalty ุจุฒุฑฺฏ ุจุฑุง cost
disc_scale:   float = 0.001  # ุฎู ฺฉูฺฺฉ โ penalty ฺฉูฺฺฉ ุจุฑุง discomfort

# ุจุนุฏ:
cost_scale:   float = 1.0    # ุจุฒุฑฺฏ โ penalty ฺฉูฺฺฉ ุจุฑุง cost
disc_scale:   float = 0.005  # ฺฉูฺฺฉ โ penalty ุฎู ุจุฒุฑฺฏ ุจุฑุง discomfort
```

**ูฺฉุชู ููู:** Scale ุจุฒุฑฺฏโุชุฑ = ุฌุฑูู ฺฉูฺฺฉโุชุฑ (ฺูู ุชูุณู ูโฺฉูู)

### ณ. Reward Function ุฌุฏุฏ (ฺฉูุงุณ `AdaptiveRewardHandler`)

#### ุงูู) Comfort Penalty ุจุง ูุฒูโูุง ูุชูุงูุช
```python
comfort_penalty = (
    100.0 * disc_band +      # ุฎุฑูุฌ ุงุฒ comfort band โ ุฌุฑูู ุดุฏุฏ
    10.0 * disc_set +        # ุฏูุฑ ุดุฏู ุงุฒ setpoint โ ุฌุฑูู ูุชูุณุท
    hard_penalty             # ุฎุฑูุฌ ุงุฒ hard band โ ุฌุฑูู ูุงุฌุนูโุจุงุฑ (d^4 * 1000)
) / disc_scale
```

#### ุจ) Bonus ุจุฒุฑฺฏ ุจุฑุง ุฑุงุญุช
```python
comfort_bonus = 20.0 if in_soft_band else 0.0  # ูพุงุฏุงุด ุจุฒุฑฺฏ ุจุฑุง ุจูุฏู ุฏุฑ comfort band
```

#### ุฌ) Cost ููุท ุฒูุงู ุงููุช ุฏุงุฑุฏ ฺฉู ุฑุงุญุช ูุณุชู
```python
cost_term = 0.0
if in_soft_band:
    cost_term = instant_cost / cost_scale  # ููุท ุงฺฏุฑ ุฑุงุญุช ุจูุฏู
# ุงฺฏุฑ ูุงุฑุงุญุช ุจูุฏู โ cost ุงุตูุงู ููู ูุณุช!
```

#### ุฏ) Peak Pricing ุญุฐู ุดุฏ
```python
peak_term = 0.0  # ฺฉุงููุงู ูุงุฏุฏู ฺฏุฑูุชู ุดุฏ
```

### ด. PPO Hyperparameters ุจูููโุชุฑ (ุฎุทูุท 108-115)

```python
learning_rate: float = 3e-4   # ฺฉู ุงูุฒุงุด ุงูุช
gamma:         float = 0.99   # ุงูุฒุงุด ุงูุช ุจุฑุง ุงูู ุจููุฏูุฏุช
ent_coef:      float = 0.01   # ฺฉุงูุด ุงูุช (exploration ฺฉูุชุฑ)
```

### ต. ุดุจฺฉู ุนุตุจ ุจุฒุฑฺฏโุชุฑ (ุฎุท 1117)
```python
net_arch=[dict(pi=[256, 256], vf=[256, 256])]  # ูุจูุงู [128, 128] ุจูุฏ
```

## ฺุฑุง ุงู ุชุบุฑุงุช ฺฉุงุฑ ูโฺฉููุฏุ

### ูฺฉุงูุฒู Reward:
```
reward = comfort_bonus - (w_disc * comfort_penalty + w_cost * cost_term + ...)

ุงฺฏุฑ T_in ุฏุฑ comfort band:
  reward โ +20 - (0.0001 * ูุฒูู_ฺฉูฺฺฉ) โ +20 โ

ุงฺฏุฑ T_in ุฎุงุฑุฌ comfort band (ูุซูุงู 2ยฐC):
  comfort_penalty = (100 * 2ยฒ + ...) / 0.005 = 80,000
  reward โ 0 - (200 * 80,000) = -16,000,000 โโโ
```

**ูุชุฌู:** Agent ุงุฏ ูโฺฏุฑุฏ ฺฉู ุญุช ุจู ููุช ูุฒูู ุจุงูุงุ ุญุชูุงู ุจุงุฏ ุฏุฑ comfort band ุจูุงูุฏ!

## ฺฺฏููู ุงุณุชูุงุฏู ฺฉููุ

### ุฑูุด ฑ: ูุณุชูู ุงุฌุฑุง
```bash
cd /workspace
python src/pi_drl_hvac_controller_fixed.py
```

### ุฑูุด ฒ: ุชูุธู ูุณุฑ ุฏุงุฏู
ุฏุฑ ูุงูุ ุฎุท 63 ุฑุง ูุฑุงุด ฺฉูุฏ:
```python
data_dir: str = r"C:\Users\FATEME\Downloads\dataverse_files"
```

### ุฑูุด ณ: ุงฺฏุฑ ูููุฒ comfort loss ุจุงูุง ุจูุฏ
ุงฺฏุฑ ุจุนุฏ ุงุฒ training ูููุฒ ูุดฺฉู ุฏุงุดุชุฏ:

#### ฺฏุฒูู ุงูู: ูุฒู discomfort ุฑุง ุจุดุชุฑ ฺฉูุฏ
```python
w_disc: float = 500.0  # ุง ุญุช 1000.0
```

#### ฺฏุฒูู ุจ: Scale ุฑุง ฺฉูฺฺฉโุชุฑ ฺฉูุฏ
```python
disc_scale: float = 0.001  # ุฌุฑูู ุดุฏุฏุชุฑ
```

#### ฺฏุฒูู ุช: Training ุจุดุชุฑ
```python
total_timesteps: int = 300_000  # ุฏู ุจุฑุงุจุฑ
```

## ูุชุงุฌ ููุฑุฏ ุงูุชุธุงุฑ

ุจุง ุงู ุชูุธูุงุชุ ุงูุชุธุงุฑ ูโุฑูุฏ:

โ **Comfort loss ฺฉุงูุด โฅ80%** ูุณุจุช ุจู ูุจู
โ **โฅ90% ุฒูุงู ุฏุงุฎู comfort band**
โ Temperature fluctuations ฺฉูุชุฑ
โ Agent ุจุดุชุฑ ON ูโูุงูุฏ (ุจุฑุง ุฑุงุญุช)

โ **Cost ุงูุฒุงุด ูพุฏุง ูโฺฉูุฏ** (ูุงุจู ูุจูู - ฺูู comfort ุงูููุช ุงุณุช)
โ **Peak power ุตูุฑ ูุณุช** (ุงู ุฎูุจ ุงุณุช! ุนู ุฏุฑ peak ูู ุจุฑุง ุฑุงุญุช ฺฉุงุฑ ูโฺฉูุฏ)

## ูพุงู ููุง

**ููุณูู ุทุฑุงุญ:**
> "ฺฉ ุฎุงูู ุณุฑุฏ ุจุง ูุจุถ ุจุฑู ุงุฑุฒุงูุ ุจโุงุฑุฒุด ุงุณุช. 
> ุฑุงุญุช ุณุงฺฉู ุงูููุช ุงูู ุงุณุชุ ุตุฑููโุฌู ุงูุฑฺ ุงูููุช ุฏูู."

ุงฺฏุฑ ุจุนุฏ ุงุฒ training ุจุง ุงู ฺฉุฏุ ูููุฒ comfort loss ุจุงูุง ุจูุฏ:
1. `w_disc` ุฑุง ุจู 500 ุง 1000 ุจุฑุณุงูุฏ
2. `total_timesteps` ุฑุง ุจู 300,000 ุงูุฒุงุด ุฏูุฏ
3. Episode length ุฑุง ุจู 2 ุฑูุฒ ุงูุฒุงุด ุฏูุฏ ุชุง reward signal ูุงุถุญโุชุฑ ุดูุฏ

ูููู ุจุงุดุฏ! ๐ฏ
